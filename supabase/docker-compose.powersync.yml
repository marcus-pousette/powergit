version: '3.9'

services:
  powersync:
    image: powersync/powersync:latest
    container_name: powersync-local
    restart: unless-stopped
    environment:
      # Connection string to the Supabase Postgres instance started via `supabase start`
      POWERSYNC_DATABASE_URL: ${POWERSYNC_DATABASE_URL:-postgres://postgres:postgres@host.docker.internal:55432/postgres}
      # Persist streamed objects and Git pack files on disk
      POWERSYNC_STORAGE_PROVIDER: file
      POWERSYNC_STORAGE_DIRECTORY: /var/lib/powersync/storage
      # Expose additional configuration points if needed
      POWERSYNC_LOG_LEVEL: ${POWERSYNC_LOG_LEVEL:-info}
      POWERSYNC_CONFIG_PATH: /config/config.yaml
    ports:
      - "${POWERSYNC_PORT:-55440}:3000"
    volumes:
      - powersync-storage:/var/lib/powersync/storage
      - ./powersync/config.yaml:/config/config.yaml:ro

volumes:
  powersync-storage:
